(window.odspNextWebpackJsonp=window.odspNextWebpackJsonp||[]).push([[121],{2101:function(e,t,n){"use strict";n.d(t,"e",function(){return u}),n.d(t,"t",function(){return p});var a=n(109),i=n(143),r=n(54),o=n(1166),s=n(155),c=n(88),d=n(226),l="DisableSubstrateSearch",u="https://outlook.office.com/search",f={ODB:1286},p=function(){function e(e,t){this._dataRequestor=new o.e({},{}),this._pageContext=t.pageContext,this._oAuthTokenProvider=t.oAuthTokenProvider,this._sharingContextInformation=t.sharingContextInformation,this._sharingContextInformation&&this._sharingContextInformation.additionalTokens&&(this._substrateToken=this._sharingContextInformation.additionalTokens.substrateToken),this.initializeDataStore()}return e.prototype.canUseSubstrate=function(){if(this._substrateToken)return!0;var e=!1;return this._pageContext&&!this._pageContext.isSPO||this._pageContext&&this._pageContext.authToken||(this._pageContext&&this._oAuthTokenProvider&&d.n.isFeatureEnabled(f)&&(e=!0),this._dataStore&&(e=e&&!this._dataStore.getValue(l,c.e.session))),e},e.prototype.disableSubstrateCallsForPicker=function(){this.initializeDataStore(),this._dataStore.setValue(l,!0,c.e.session)},e.prototype.getSubstrateToken=function(){var e=this;if(this._substrateToken)return a.n.resolve(this._substrateToken);if(this._oAuthTokenProvider){var t=new i.e({name:"PeoplePicker.GetSubstrateToken"});return this._oAuthTokenProvider.getToken(u).then(function(e){return t.end({resultType:r.e.Success}),e},function(n){return a.n.isCanceled(n)?(t.end({resultType:r.e.ExpectedFailure,resultCode:"Canceled"}),a.n.reject(n)):(t.end({resultCode:"PeoplePicker.GetSubstrateTokenError",resultType:r.e.Failure,extraData:{serverErrorCode:n._serverErrorCode,message:n.message}}),e.disableSubstrateCallsForPicker(),null)})}return null},e.prototype.init=function(e){var t,n,a="".concat(u,"/api/v1/init?scenario=").concat("documentshare");this._dataRequestor.send({apiName:"Substrate.PeopleSearch.Init",path:a,headers:{Authorization:"Bearer "+e,"X-AnchorMailbox":"OID:".concat(null===(t=this._pageContext)||void 0===t?void 0:t.aadUserId,"@").concat(null===(n=this._pageContext)||void 0===n?void 0:n.aadTenantId)},needsAuthorization:!1})},e.prototype.initializeDataStore=function(){this._dataStore||(this._dataStore=new s.e("PeoplePicker",c.e.session))},e}()},2129:function(e,t,n){"use strict";n.d(t,"e",function(){return u}),n.d(t,"t",function(){return m});var a=n(109),i=n(226),r=n(54),o=n(143),s=n(155),c=n(88),d=n(14),l={ODB:387},u="https://graph.microsoft.com",f="DisableGraph",p=!d.t.isActivated("f70d9a82-9e0b-4ab4-8337-221f328b5181","10/19/2022","enable crossdomain fetch graph token")&&!i.n.isFeatureEnabled({ECS:1047773}),m=function(){function e(e,t){var n=this;this._getOauthProviderGetTokenPromise=function(){return n._oAuthTokenProvider?n._oAuthTokenProvider.getToken(u):null},this._getTokenReturnPromise=function(e,t,i,o){return e.then(function(e){return i.end({resultType:r.e.Success}),e},function(e){var s=o?o():null;return s?n._getTokenReturnPromise(s,"oAuthTokenProvider.getToken",i):a.n.isCanceled(e)?(i.end({resultType:r.e.ExpectedFailure,resultCode:"Canceled"}),a.n.reject(e)):(i.end({resultCode:"PeoplePicker.GetGraphTokenError",resultType:r.e.Failure,extraData:{serverErrorCode:e._serverErrorCode,message:e.message,providerName:t}}),n.disableGraphCallsForPicker(),null)})},this._pageContext=t.pageContext,this._sharingContextInformation=t.sharingContextInformation,this._oAuthTokenProvider=t.oAuthTokenProvider,this._sharingContextInformation&&this._sharingContextInformation.additionalTokens&&(this._graphToken=this._sharingContextInformation.additionalTokens.graphToken),this.initializeDataStore()}return e.prototype.canUseGraph=function(){if(this._graphToken)return!0;if(this._pageContext&&(!p||!this._pageContext.getAuthToken)&&this._pageContext.authToken)return!1;var e=this._pageContext&&(this._oAuthTokenProvider||p&&this._pageContext.getAuthToken)&&i.n.isFeatureEnabled(l);return this._dataStore&&(e=e&&!this._dataStore.getValue(f,c.e.session)),e},e.prototype.disableGraphCallsForPicker=function(){this.initializeDataStore(),this._dataStore.setValue(f,!0,c.e.session)},e.prototype.getGraphToken=function(){var e=this;if(this._graphToken)return a.n.resolve(this._graphToken);if(p){var t=new o.e({name:"PeoplePicker.GetGraphToken"});if(this._pageContext&&this._pageContext.getAuthToken)return this._getTokenReturnPromise(this._pageContext.getAuthToken("ms-graph",this._pageContext.msGraphEndpointUrl?this._pageContext.msGraphEndpointUrl:"https://graph.microsoft.com").then(function(e){if(e)return e;throw new Error("token is empty")}),"pageContext.getAuthToken",t,this._getOauthProviderGetTokenPromise);if(this._oAuthTokenProvider)return this._getTokenReturnPromise(this._oAuthTokenProvider.getToken(u),"oAuthTokenProvider.getToken",t)}else if(this._oAuthTokenProvider){var n=new o.e({name:"PeoplePicker.GetGraphToken"});return this._oAuthTokenProvider.getToken(u).then(function(e){return n.end({resultType:r.e.Success}),e},function(t){return a.n.isCanceled(t)?(n.end({resultType:r.e.ExpectedFailure,resultCode:"Canceled"}),a.n.reject(t)):(n.end({resultCode:"PeoplePicker.GetGraphTokenError",resultType:r.e.Failure,extraData:{serverErrorCode:t._serverErrorCode,message:t.message}}),e.disableGraphCallsForPicker(),null)})}return null},e.prototype.initializeDataStore=function(){this._dataStore||(this._dataStore=new s.e("PeoplePicker",c.e.session))},e}()},2132:function(e,t,n){"use strict";n.d(t,"e",function(){return p});var a=n(199),i=n(2240),r=n(698),o=n(701),s=n(2129),c=n(2101),d=n(109),l=n(63),u=function(){function e(e,t){this._getIdentityDataSource=t.getIdentityDataSource}return e.prototype.getToken=function(e,t){return this.getInstrumentedToken(e,t).then(function(e){return e.tokenInfo.token})},e.prototype.getInstrumentedToken=function(e,t){var n=Date.now();return d.n.resolve(this._getIdentityDataSource().then(function(t){return e===s.e&&t.getGraphToken?t.getGraphToken({resource:e}):e===c.e&&t.getSubstrateToken?t.getSubstrateToken(o.e.Default):"ocps"===e&&t.getOCPSToken?t.getOCPSToken():t.getOAuthSessionToken?t.getOAuthSessionToken(e):void 0}).then(function(e){var t=null==e?void 0:e.accessToken;if(!e||!t)throw new l.e({code:"UnableToResolveToken"});return{tokenInfo:{token:t,isGuest:!1,expirationTimeMs:e.tokenExpiry},spRequestId:e.correlationId||"",spRequestTimestamp:n}}))},e}(),f=Object(a.r)("OAuthTokenDataSource",u,{getIdentityDataSource:r.e.async.lazy}),p=Object(a.r)("OAuthTokenProviderBase",i.e,{oAuthTokenDataSource:f})},2240:function(e,t,n){"use strict";var a,i=n(109),r=n(143),o=n(54);!function(e){e[e.InteractionRequired=10013]="InteractionRequired"}(a||(a={}));var s=function(){function e(e,t){void 0===e&&(e={}),this._dataSource=t.oAuthTokenDataSource}return e.prototype.getToken=function(e,t){var n=new r.e({name:"getToken"});return this._dataSource.getToken(e,t).then(function(e){return n.end({resultType:o.e.Success}),e},function(e){return n.end({resultType:o.e.Failure}),i.n.reject(e)})},e.prototype.getInstrumentedToken=function(e,t){var n=new r.e({name:"getToken"});return this._dataSource.getInstrumentedToken(e,t).then(function(e){return n.end({resultType:o.e.Success}),e},function(e){return n.end({resultType:o.e.Failure}),i.n.reject(e)})},e}();t.e=s},2374:function(e,t,n){"use strict";var a=n(2476),i=n(122),r=n(2035),o=n(54),s=n(235),c=n(31),d=n(109),l=n(1172),u=n(2144),f=n(16),p=new RegExp("^".concat("Templates","$"),"i"),m=function(){function e(){}return e.isFolder=function(e,t){var n=!!e;return n&&!(n=e.type===s.e.Folder)&&t&&e.type===s.e.OneNote&&(n=!!f.e.isActivated("94B1529C-14BB-4854-B5FC-748FCEFF2681","3/29/2022","Check for OneNote note")||!e.contentTypeId||0!==e.contentTypeId.lastIndexOf("0x0101",0)),n},e.isCheckedOut=function(e){return l.e(e)},e.isCheckedOutByUser=function(e,t){return l.n(e,t)},e.isCheckedOutByOther=function(t,n){return e.isCheckedOut(t)&&!e.isCheckedOutByUser(t,n)},e.showCheckedOutByOtherDialog=function(e){return e.requestDialog({title:a.i,component:{name:u.e.tagName,params:{text:a.a}},actions:[{name:i.cancelActionText,execute:function(){return d.n.wrap(2)},icon:new r.e("Cancel"),isDefault:!0}]}).wait().then(function(){return{resultType:o.e.Success}})},e.isPublished=function(t,n){return n.isModerated?t.properties[e.PublishProperty]&&"3"!==t.properties[e.PublishProperty]&&"1"!==t.properties[e.PublishProperty]:0===e.getVersionNoModeration(t,n).minor&&0!==e.getVersionNoModeration(t,n).major},e.needsPublishingReminder=function(t,n){return!e.isPublished(t,n)&&!e.isPendingApproval(t,n)&&!e.isPageTemplate(t)&&(!t.properties||!t.properties._ScheduledVersion||t.properties.owshiddenversion!==t.properties._ScheduledVersion)&&c.e.hasItemPermission(t,c.e.editListItems)&&n.enableMinorVersions&&!e.isFolder(t,!0)},e.isPublishingRelevant=function(t,n){return c.e.hasItemPermission(t,c.e.editListItems)&&n.enableMinorVersions&&!e.isCheckedOut(t)&&!e.isFolder(t,!0)},e.getVersionNoModeration=function(e,t){return t.isModerated?{major:0,minor:0}:this.getVersion(e,t)},e.getVersion=function(t,n){if(t&&t.properties&&t.properties[e.VersionProperty]){var a=Number(t.properties[e.VersionProperty])%512;return{major:Math.floor(Number(t.properties[e.VersionProperty])/512),minor:a}}return{major:0,minor:0}},e.isPendingApproval=function(t,n){return!!n.isModerated&&t&&t.properties&&t.properties[e.PublishProperty]&&"2"===t.properties[e.PublishProperty]},e.isPageTemplate=function(e){if(!e)return!1;var t=!1,n=!1;if(e.id){var a=e.id.split("/"),i=a.length;t=p.test(a[i-2])}if(e.properties){var r=e.properties._SPSitePageFlags;n=!!r&&r.filter(function(e){return"template"===e.toLowerCase()}).length>0}return t||n},e.isApprovalRelevant=function(t,n){return n&&n.isModerated&&!e.isCheckedOut(t)&&c.e.hasItemPermission(t,c.e.editListItems)&&c.e.hasItemPermission(t,c.e.approveItems)},e.FileTypeProperty="FSObjType",e.PublishProperty="_ModerationStatus.",e.VersionProperty="_UIVersion",e}();t.e=m},2506:function(e,t){!function(e){"use strict";if(!e.fetch){var t="URLSearchParams"in e,n="Symbol"in e&&"iterator"in Symbol,a="FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),i="FormData"in e,r="ArrayBuffer"in e;if(r)var o=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],s=function(e){return e&&DataView.prototype.isPrototypeOf(e)},c=ArrayBuffer.isView||function(e){return e&&o.indexOf(Object.prototype.toString.call(e))>-1};m.prototype.append=function(e,t){e=u(e),t=f(t);var n=this.map[e];this.map[e]=n?n+","+t:t},m.prototype.delete=function(e){delete this.map[u(e)]},m.prototype.get=function(e){return e=u(e),this.has(e)?this.map[e]:null},m.prototype.has=function(e){return this.map.hasOwnProperty(u(e))},m.prototype.set=function(e,t){this.map[u(e)]=f(t)},m.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},m.prototype.keys=function(){var e=[];return this.forEach(function(t,n){e.push(n)}),p(e)},m.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),p(e)},m.prototype.entries=function(){var e=[];return this.forEach(function(t,n){e.push([n,t])}),p(e)},n&&(m.prototype[Symbol.iterator]=m.prototype.entries);var d=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];y.prototype.clone=function(){return new y(this,{body:this._bodyInit})},v.call(y.prototype),v.call(D.prototype),D.prototype.clone=function(){return new D(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new m(this.headers),url:this.url})},D.error=function(){var e=new D(null,{status:0,statusText:""});return e.type="error",e};var l=[301,302,303,307,308];D.redirect=function(e,t){if(-1===l.indexOf(t))throw new RangeError("Invalid status code");return new D(null,{status:t,headers:{location:e}})},e.Headers=m,e.Request=y,e.Response=D,e.fetch=function(e,t){return new Promise(function(n,i){var r=new y(e,t),o=new XMLHttpRequest;o.onload=function(){var e,t,a={status:o.status,statusText:o.statusText,headers:(e=o.getAllResponseHeaders()||"",t=new m,e.split(/\r?\n/).forEach(function(e){var n=e.split(":"),a=n.shift().trim();if(a){var i=n.join(":").trim();t.append(a,i)}}),t)};a.url="responseURL"in o?o.responseURL:a.headers.get("X-Request-URL");var i="response"in o?o.response:o.responseText;n(new D(i,a))},o.onerror=function(){i(new TypeError("Network request failed"))},o.ontimeout=function(){i(new TypeError("Network request failed"))},o.open(r.method,r.url,!0),"include"===r.credentials&&(o.withCredentials=!0),"responseType"in o&&a&&(o.responseType="blob"),r.headers.forEach(function(e,t){o.setRequestHeader(t,e)}),o.send(void 0===r._bodyInit?null:r._bodyInit)})},e.fetch.polyfill=!0}function u(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function f(e){return"string"!=typeof e&&(e=String(e)),e}function p(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return n&&(t[Symbol.iterator]=function(){return t}),t}function m(e){this.map={},e instanceof m?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function _(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function h(e){return new Promise(function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function b(e){var t=new FileReader,n=h(t);return t.readAsArrayBuffer(e),n}function g(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function v(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,e)if("string"==typeof e)this._bodyText=e;else if(a&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(i&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(t&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(r&&a&&s(e))this._bodyArrayBuffer=g(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!r||!ArrayBuffer.prototype.isPrototypeOf(e)&&!c(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=g(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},a&&(this.blob=function(){var e=_(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?_(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(b)}),this.text=function(){var e,t,n,a=_(this);if(a)return a;if(this._bodyBlob)return e=this._bodyBlob,n=h(t=new FileReader),t.readAsText(e),n;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),n=new Array(t.length),a=0;a<t.length;a++)n[a]=String.fromCharCode(t[a]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},i&&(this.formData=function(){return this.text().then(S)}),this.json=function(){return this.text().then(JSON.parse)},this}function y(e,t){var n,a,i=(t=t||{}).body;if(e instanceof y){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new m(e.headers)),this.method=e.method,this.mode=e.mode,i||null==e._bodyInit||(i=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new m(t.headers)),this.method=(a=(n=t.method||this.method||"GET").toUpperCase(),d.indexOf(a)>-1?a:n),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function S(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var n=e.split("="),a=n.shift().replace(/\+/g," "),i=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(a),decodeURIComponent(i))}}),t}function D(e,t){t||(t={}),this.type="default",this.status="status"in t?t.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new m(t.headers),this.url=t.url||"",this._initBody(e)}}("undefined"!=typeof self?self:this)},2520:function(e,t,n){"use strict";n.d(t,"e",function(){return a.e}),n(2506);var a=n(2132)},2677:function(e,t,n){"use strict";n.d(t,"e",function(){return r});var a=n(11),i=n(199),r=new a.t({name:"WinAppCommunicator.key",loader:new i.t(function(){return n.e(395).then(n.bind(null,3181)).then(function(e){return e.resourceKey})})})},3052:function(e,t,n){"use strict";var a,i,r;n.d(t,"n",function(){return a}),n.d(t,"e",function(){return i}),n.d(t,"t",function(){return r}),function(e){e[e.DownloadSingleFile=0]="DownloadSingleFile",e[e.DownloadMultiFile=1]="DownloadMultiFile",e[e.DownloadFileInZip=2]="DownloadFileInZip"}(a||(a={})),function(e){e.Files="files",e.Recent="recent",e.Shared="shared",e.RecycleBin="recyclebin",e.Photos="photos"}(i||(i={})),function(e){e.Navigation="NavigationRequest",e.Click="ClickRequest",e.Search="SearchRequest",e.SearchSuggestionClick="SearchSuggestionClickRequest",e.TokenResponse="TokenResponse",e.TokenRequest="OAuthTokenRequest",e.DarkModeRequest="DarkModeRequest",e.LokiTokenRequest="LokiTokenRequest",e.SubstrateTokenRequest="SubstrateTokenRequest",e.EnablePersonalVault="EnablePersonalVault"}(r||(r={}))},3514:function(e,t,n){"use strict";n.d(t,"e",function(){return r});var a=n(11),i=n(199),r=new a.t({name:"PushChannelProvider.key",loader:new i.t(function(){return n.e(459).then(n.bind(null,3816)).then(function(e){return e.resourceKey})})})},3541:function(e,t,n){"use strict";var a=n(0),i=function(e){function t(t){return e.call(this,{dataSourceName:"MicroServiceEndPointDataSource"},{pageContext:t})||this}return Object(a.__extends)(t,e),t.prototype.getMicroServiceEndPoints=function(e){var t="".concat(this._pageContext.webAbsoluteUrl,"/_api/microservicemanager/getserviceurls?service='").concat(e,"'");return this.dataRequestor.getData({url:t,method:"GET",qosName:"GetServiceUrls"}).then(function(e){return e&&e.d&&e.d.GetServiceUrls&&e.d.GetServiceUrls.results&&e.d.GetServiceUrls.results[0]})},t.prototype.getAllMicroServiceEndPoints=function(e){var t="".concat(this._pageContext.webAbsoluteUrl,"/_api/microservicemanager/getserviceurls?service='").concat(e,"'");return this.dataRequestor.getData({url:t,method:"GET",qosName:"GetAllServiceUrls"}).then(function(e){return e&&e.d&&e.d.GetServiceUrls&&e.d.GetServiceUrls.results})},t}(n(1277).t);t.e=i},3984:function(e,t,n){"use strict";n.d(t,"e",function(){return c});var a=n(0),i=n(3541),r=n(199),o=n(53),s=function(e){function t(t,n){return e.call(this,n.pageContext)||this}return Object(a.__extends)(t,e),t}(i.e),c=Object(r.r)("MicroserviceEndPointDataSource.key",s,{pageContext:o.f})},4362:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n(109),r=n(2374),o=n(820),s=n(54),c=n(14),d=n(105),l=n(2017),u=n(235),f=n(2057),p=n(184),m=n(2801),_=n(1502),h=n(131),b=n(33),g=n(11),v=n(199),y=n(80),S=n(3514),D=n(2520),I=n(3984),x=n(132),C=n(2677),O=n(63),w=n(3052),E=n(1744),A=!c.e.isActivated("DA910F66-8C98-428B-8A0F-C9BDE6481EB9","08/26/2022","Perform extra sanitization prior to logging extension, part 2"),L=5e3,k="od-download-tab",M=new g.t({name:"DownloadExecutor",loader:new v.t(function(){return i.n.resolve(n.e(119).then(n.bind(null,5018))).then(function(e){return e.typeResourceKey})})}),P=function(e){function t(t){var n=e.call(this,t)||this;return n._sessionManagementProvider=n.resources.consume(_.e.optional),n._platform=n.resources.consume(p.e),n._oAuthTokenProvider=n.resources.consume(D.e.optional),n._navigation=n.resources.consume(h.e),n._hiddenDomProvider=n.resources.consume(m.e),n.selectionHelper=t.selectionHelper,n.currentItem=t.currentItem,n.dialogProvider=n.resources.consume(f.e),n.isOneDriveWinApp=Object(x.e)(),n}return Object(a.__extends)(t,e),t.prototype.execute=function(e,t){var n,r=this,o=this.selectionHelper.selection;return n={items:o.peek().map(function(e){return e.peek()})},this.onPreDownloadItems(n.items).then(function(e){var o,c;return e?r.isOneDriveWinApp?(1===n.items.length&&n.items[0].type!==u.e.Folder?r.resources.consumeAsync(d.c).then(function(e){var t=n.items[0];e.getDownloadUrl(t,{downloadType:0}).then(function(e){r.resources.consumeAsync(C.e).then(function(n){var a={command:"Download",type:w.n.DownloadSingleFile,downloadUrl:e,zipFileName:t.displayName};n.sendCommand({command:JSON.stringify({DownloadCommand:a})})})})}):r.resources.consumeAsync(d.c).then(function(e){e.getDownloadZipRequest(n).then(function(e){r.resources.consumeAsync(C.e).then(function(t){t.sendCommand({command:e})})})}),{resultType:s.e.Success,extraData:(null===(o=null==t?void 0:t.data)||void 0===o?void 0:o.extraData)||{}}):r.resources.consumeAsync(d.c).then(function(e){return e.downloadItems(n).then(function(){var e,i={},r={count:n.items.length};if(1===n.items.length){i.fileType=u.e[n.items[0].type];var o=A&&n.items[0].extension?Object(E.e)(n.items[0].extension):n.items[0].extension||"";i.extension=o}return{resultType:s.e.Success,extraData:Object(a.__assign)(Object(a.__assign)({},(null===(e=null==t?void 0:t.data)||void 0===e?void 0:e.extraData)||{}),i),extraMetrics:r}})}):i.n.wrap({resultType:s.e.ExpectedFailure,extraData:(null===(c=null==t?void 0:t.data)||void 0===c?void 0:c.extraData)||{}})})},t.prototype.executeVroomDownload=function(e){var n=this,a=e.itemsData,r=e.docIds,o=e.zipApiUrl,s=e.provider,c=(e.method,e.appId),d=(e.loggingEvent,e.fileDisplayName),l=e.skipAuthToken;if(!(t.doc_ids===r&&Date.now()-t.last_download<L)){t.last_download=Date.now(),t.doc_ids=r;var u=function(){return n._doDownload({itemsData:a,docIds:r,zipApiUrl:o,provider:s,sessionToken:null,oAuthToken:null,appId:c,fileDisplayName:d||""})};if(a&&-1!==a[0].docId.indexOf("access_token")||"spo"===s&&this._oAuthTokenProvider)try{return i.n.resolve(this.resources.consumeAsync(I.e)).then(function(e){return e.getMicroServiceEndPoints("media")}).then(function(e){return n._oAuthTokenProvider.getToken(e,!0)}).then(function(e){return n._doDownload({itemsData:a,docIds:r,zipApiUrl:o,provider:s,sessionToken:null,oAuthToken:e,appId:c,fileDisplayName:d||""})},u)}catch(e){return u()}return l?this._doDownload({itemsData:a,docIds:r,zipApiUrl:o,provider:s,sessionToken:void 0,oAuthToken:null,appId:c,fileDisplayName:d||""}):this._sessionManagementProvider.getToken().then(function(e){return n._doDownload({itemsData:a,docIds:r,zipApiUrl:o,provider:s,sessionToken:e,oAuthToken:null,appId:c,fileDisplayName:d||""})},function(e){if(e instanceof O.e&&"unauthUser"===e.code)return u()})}},t.prototype.onPreDownloadItems=function(e){return i.n.wrap(!0)},t.prototype._doDownload=function(e){var t=e.itemsData,n=e.zipApiUrl,a=e.provider,i=e.sessionToken,r=e.oAuthToken,o=e.appId,s=e.fileDisplayName;return t?this._completeDownloadasZip(t,n,a,i,r,o):this._completeDownloadFile(n,i,s)},t.prototype._completeDownloadFile=function(e,t,n){if(e+=t?"?access_token=".concat(t.accessToken):"",this.isOneDriveWinApp&&this.resources.consumeAsync(C.e).then(function(t){var a={command:"Download",type:w.n.DownloadSingleFile,downloadUrl:e,zipFileName:n};t.sendCommand({command:JSON.stringify({DownloadCommand:a})})}),this._platform.isMobile)return this._navigation.navigateTo({url:e,frameId:"_self"}),i.n.wrap({resultType:s.e.Success});if(this._platform.isIE)return this._downloadForIE(k,e),i.n.wrap({resultType:s.e.Success});var a=Math.random(),r=this._getDownloadIframe(a);return document.body.appendChild(r),r.src=e,this.async.setTimeout(function(){r.remove()},2e4),i.n.wrap({resultType:s.e.Success})},t.prototype._completeDownloadasZip=function(e,n,a,r,o,c){var d=this;t.zip_count++;var l=y.e.generate(),u="OneDrive_"+t.zip_count+"_"+(new Date).toLocaleDateString().replace(/\//g,"-").replace(/[^ -~]/g,"")+".zip";return e&&1===e.length&&(u=e[0].name+".zip"),i.n.resolve(this.resources.consumeAsync(S.e.optional)).then(function(t){var i,f=t&&t.getNotificationUrl()||"";f&&Object(b.isFeatureEnabled)(b.DownloadNotifications)&&d.resources.consumeAsync(M).then(function(e){var t=new e({items:[],guid:l,zipFileName:u});d.trackPromise(t.start()),t.wait()});var p=2e4;if(d._platform.isIE&&(i=d._downloadForIE(k),p=L),d.isOneDriveWinApp){var m={files:JSON.stringify({items:e}),notificationUrlValue:f,guid:l,provider:a,zipFileName:u,oAuthToken:o||"",accessToken:r&&r.accessToken||"",appId:c},_={command:"Download",type:w.n.DownloadMultiFile,downloadUrl:n,zipFileName:u,postBody:JSON.stringify({request:m})};return d.resources.consumeAsync(C.e).then(function(e){e.sendCommand({command:JSON.stringify({DownloadCommand:_})})}),{resultType:s.e.Success}}var h=Math.random(),g=d._getDownloadIframe(h),v=d._hiddenDomProvider.requestControl({name:"od-downloadaszip",params:{filesValue:JSON.stringify({items:e}),notificationUrlValue:f,guid:l,formAction:n,providerValue:a,id:h,zipFileName:u,target:d._platform.isIE?k:g.id,oAuthToken:o||"",accessToken:r&&r.accessToken||"",appId:c||"",resources:d.resources}}),y=document.getElementById("form_download_as_zip"+h);y.parentNode.appendChild(g),y.submit();var S=d.addDisposable({dispose:function(){d._hiddenDomProvider.disposeControl(v)}});return d.async.setTimeout(function(){S.dispose(),i&&i.close()},p),{resultType:s.e.Success}})},t.prototype._getDownloadIframe=function(e){var t=document.createElement("iframe");return t.id="od-download-iframe"+e,t.name=t.id,t.hidden=!0,t},t.prototype._downloadForIE=function(e,t){var n;return void 0===t&&(t=""),n=window.open(t,e),this.async.setTimeout(function(){n.close()},L),n},t.zip_count=0,t}(l.n),T=n(183);Object(T.n)([{rawString:".od-DownloadAsZip{visibility:hidden}"}]);var U=function(e){function t(t){var n=e.call(this,t)||this;return n.formAction=t.formAction,n.filesValue=t.filesValue,n.providerValue=t.providerValue,n.id="form_download_as_zip"+t.id,n.notificationUrlValue=t.notificationUrlValue,n.accessToken=t.accessToken,n.zipFileName=t.zipFileName,n.target=t.target,n.oAuthToken=t.oAuthToken,n.guid=t.guid,n.method=t.method||"Post",n.appId=t.appId,n}return Object(a.__extends)(t,e),t}(n(2019).e),F=(n(2020).e({tagName:"od-downloadaszip",template:'<div id="od-Download-As-Zip" class="od-DownloadAsZip"><form class="DownloadAsZipForm" name="form_download_as_zip" data-bind="attr:{action:formAction,target:target,id:id,method:method}"><input id="download_input_1" name="provider" type="hidden" data-bind="value:providerValue"><input id="download_input_2" name="guid" type="hidden" data-bind="value:guid"><input id="download_input_3" name="files" type="hidden" data-bind="value:filesValue"><input id="download_input_4" name="notificationUrl" type="hidden" data-bind="value:notificationUrlValue"><input id="download_input_5" name="accessToken" type="hidden" data-bind="value:accessToken"><input id="download_input_6" name="zipFileName" type="hidden" data-bind="value:zipFileName"><input id="download_input_7" name="oAuthToken" type="hidden" data-bind="value:oAuthToken"><input id="download_input_8" name="appId" type="hidden" data-bind="value:appId"></form></div>',viewModel:U,synchronous:!0}),n(187)),H=!c.e.isActivated("371F4335-A870-40C0-9E49-20CF6BEBD5EC","05/13/2022","Add isZip property to extra data to distinguish download scenarios"),R=function(e){function t(t){return e.call(this,t)||this}return Object(a.__extends)(t,e),t.prototype.execute=function(t,n){var c=this;try{n.data.extraData||(n.data.extraData={}),H&&(n.data.extraData=Object(a.__assign)(Object(a.__assign)({},n.data.extraData),{isZip:!1}));var l=this.selectionHelper.selection.peek();return l.length>1||r.e.isFolder(l[0].peek(),!1)?(H&&(n.data.extraData=Object(a.__assign)(Object(a.__assign)({},n.data.extraData),{isZip:!0})),i.n.resolve(this.resources.consumeAsync(d.y)).then(function(t){var a="",s=0,d=0,f=Object(b.isFeatureEnabled)(b.MediaTAUseVroomV21),p=l.map(function(e){if(e){var n=e.peek(),i=n.urls[o.t.itemUrl];a+=i,n.type===u.e.OneNote&&s++;var c=r.e.isFolder(n,!1);c&&d++;var l=t.getAccessToken(n,{apiVersion:f?"v2.1":"v2.0"});return{name:n.name,size:n.size,docId:"".concat(i).concat(-1!==i.indexOf("?")?"&":"?","access_token=").concat(l.accessToken),isFolder:c}}});if(!p)return i.n.wrapError(new Error("No item metadata for download."));p=p.filter(Boolean),F.e(n.data.extraData,{oneNotesCount:s,filesCount:l.length-d,foldersCount:d});var m=l[0].peek().urls[o.t.downloadAsZip];return e.prototype.executeVroomDownload.call(c,{itemsData:p,docIds:a,zipApiUrl:m,provider:"spo",method:"POST",appId:"",loggingEvent:n})})):e.prototype.execute.call(this,t,n)}catch(e){return i.n.wrap({resultType:s.e.Failure,extraData:Object(a.__assign)(Object(a.__assign)({},n.data.extraData||{}),{errorStack:e.stack}),resultCode:e.name,error:"".concat(e.name,"_").concat(e.message)})}},t}(P);t.default=R}}]);